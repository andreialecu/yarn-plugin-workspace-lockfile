/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-workspace-lockfile",
factory: function (require) {
var plugin=(()=>{var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var f=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(o,i)=>(typeof require<"u"?require:o)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var h=(e,o)=>{for(var i in o)l(e,i,{get:o[i],enumerable:!0})},P=(e,o,i,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of m(o))!y.call(e,a)&&a!==i&&l(e,a,{get:()=>o[a],enumerable:!(r=d(o,a))||r.enumerable});return e};var S=e=>P(l({},"__esModule",{value:!0}),e);var F={};h(F,{default:()=>v});var t=f("@yarnpkg/core"),w=f("@yarnpkg/cli"),s=f("@yarnpkg/fslib"),W=async(e,{cwd:o})=>{let i=await t.Configuration.find(o,(0,w.getPluginConfiguration)()),r=await t.Cache.find(i),{project:a,workspace:n}=await t.Project.find(i,o);a.originalPackages=new Map(e.originalPackages),a.storedResolutions=new Map(e.storedResolutions);let c=new Set([n]);for(let p of c)for(let g of t.Manifest.hardDependencies)for(let u of p.manifest.getForScope(g).values()){let k=a.tryWorkspaceByDescriptor(u);k!==null&&c.add(k)}return await a.resolveEverything({cache:r,report:new t.ThrowReport}),await a.fetchEverything({cache:r,report:new t.ThrowReport}),a.generateLockfile()},L=e=>`\x1B[32m${e}\x1B[0m`,I={configuration:{workspaceLockfiles:{description:"List of the workspaces that need a specific lockfile",type:t.SettingsType.STRING,default:!0,isArray:!0},workspaceLockfileFilename:{description:"Name of the workspaces specific lockfile",type:t.SettingsType.STRING,default:"yarn.lock-workspace"}},hooks:{afterAllInstalled:async(e,o)=>{let i=e.configuration.values.get("workspaceLockfiles"),r=e.configuration.values.get("workspaceLockfileFilename"),a=Array.isArray(i)?new Set(i.map(n=>e.getWorkspaceByIdent(t.structUtils.parseIdent(n)))):new Set(e.workspaces);for(let n of a){let c=s.ppath.join(n.cwd,r),p=s.ppath.join(n.cwd,s.Filename.lockfile);await s.xfs.renamePromise(c,p),await s.xfs.writeFilePromise(p,await W(e,n)),await s.xfs.renamePromise(p,c),o.report.reportInfo(null,`${L("\u2713")} Wrote ${c}`)}}}},v=I;return S(F);})();
return plugin;
}
};
